{% extends "base.html" %}

{% block title %}Profile & Settings{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- Left Sidebar Navigation -->
    <div class="profile-sidebar">
        <div class="sidebar-header">
            <h3>‚öôÔ∏è Settings</h3>
        </div>
        <nav class="sidebar-nav">
            <a href="#user-details" class="nav-item active" onclick="switchTab(event, 'user-details')">
                <span class="nav-icon">üë§</span>
                <span class="nav-text">User Details</span>
            </a>
            <a href="#zerodha" class="nav-item" onclick="switchTab(event, 'zerodha')">
                <span class="nav-icon">üîó</span>
                <span class="nav-text">Zerodha Connection</span>
                <span id="zerodha-indicator" class="nav-badge badge-warning"></span>
            </a>
            <a href="#ai-integration" class="nav-item" onclick="switchTab(event, 'ai-integration')">
                <span class="nav-icon">ü§ñ</span>
                <span class="nav-text">AI Integration</span>
                <span id="ai-indicator" class="nav-badge badge-secondary"></span>
            </a>
            <a href="#trading-settings" class="nav-item" onclick="switchTab(event, 'trading-settings')">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Trading Settings</span>
            </a>
            <a href="#notifications" class="nav-item" onclick="switchTab(event, 'notifications')">
                <span class="nav-icon">üîî</span>
                <span class="nav-text">Notifications</span>
            </a>
            <a href="#appearance" class="nav-item" onclick="switchTab(event, 'appearance')">
                <span class="nav-icon">üé®</span>
                <span class="nav-text">Appearance</span>
            </a>
            <a href="#security" class="nav-item" onclick="switchTab(event, 'security')">
                <span class="nav-icon">üîí</span>
                <span class="nav-text">Security</span>
            </a>
        </nav>
    </div>

    <!-- Main Content Area -->
    <div class="profile-content">
        <!-- User Details Section -->
        <div id="user-details-section" class="content-section active">
            <div class="section-header">
                <h2>üë§ User Details</h2>
                <p class="subtitle">Manage your personal information</p>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div id="user-profile">
                        <p>Loading user details...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zerodha Connection Section -->
        <div id="zerodha-section" class="content-section">
            <div class="section-header">
                <h2>üîó Zerodha Connection</h2>
                <p class="subtitle">Connect your Zerodha account for live trading</p>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div id="zerodha-disconnected">
                        <div class="info-box">
                            <p><strong>Why Connect Zerodha?</strong></p>
                            <ul>
                                <li>Place live orders directly from the app</li>
                                <li>Real-time portfolio sync</li>
                                <li>Automatic order updates</li>
                                <li>Trailing stop-loss execution</li>
                            </ul>
                        </div>
                        
                        <form id="connect-form" style="margin-top: 30px;">
                            <div class="form-group">
                                <label for="api-key">API Key *</label>
                                <input type="text" id="api-key" class="form-control" required 
                                       placeholder="Your Zerodha API Key">
                                <small>Get your API key from <a href="https://developers.kite.trade/" target="_blank">developers.kite.trade</a></small>
                            </div>
                            <div class="form-group">
                                <label for="api-secret">API Secret *</label>
                                <input type="password" id="api-secret" class="form-control" required
                                       placeholder="Your Zerodha API Secret">
                                <small>Keep this secret secure - never share it</small>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <span>üîó Connect Zerodha</span>
                            </button>
                        </form>
                    </div>
                    
                    <div id="zerodha-connected" style="display: none;">
                        <div class="success-box">
                            <p><strong>‚úÖ Connected to Zerodha</strong></p>
                            <p id="zerodha-user-info" style="margin-top: 10px;"></p>
                        </div>
                        
                        <div class="connection-actions" style="margin-top: 30px;">
                            <button id="disconnect-btn" class="btn btn-danger">
                                <span>üîå Disconnect</span>
                            </button>
                            <button class="btn btn-secondary" onclick="refreshZerodhaStatus()">
                                <span>üîÑ Refresh Status</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Integration Section -->
        <div id="ai-integration-section" class="content-section">
            <div class="section-header">
                <h2>ü§ñ AI Integration</h2>
                <p class="subtitle">Configure AI providers for intelligent trade analysis</p>
            </div>
            
            <!-- General AI Settings -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <h3>‚öôÔ∏è General Settings</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="default-ai-provider">Default AI Provider</label>
                        <select id="default-ai-provider" class="form-control">
                            <option value="gemini">Google Gemini - FREE! ‚≠ê</option>
                            <option value="claude">Claude (Anthropic)</option>
                            <option value="openai">OpenAI (ChatGPT)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="auto-analyze-enabled" disabled>
                            Auto-analyze trades (Coming Soon)
                        </label>
                        <small class="text-muted d-block">Automatically analyze all scanner results</small>
                    </div>
                </div>
            </div>

            <!-- Claude AI Configuration -->
            <div class="card" style="margin-bottom: 20px; border: 2px solid #667eea;">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3>üß† Claude AI (Anthropic) ‚≠ê RECOMMENDED</h3>
                    <span id="claude-status" class="status-indicator" style="background: white;">‚óè</span>
                </div>
                <div class="card-body">
                    <div style="background: #e8f5e9; border: 2px solid #4caf50; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                        <strong style="color: #2e7d32;">üí∞ FREE $5 Credit Available!</strong>
                        <p style="margin: 8px 0 0 0; color: #1b5e20;">
                            Get your free API key from <a href="https://console.anthropic.com" target="_blank" style="color: #1976d2; font-weight: 600;">console.anthropic.com</a><br>
                            No credit card required ‚Ä¢ 20,000 free analyses ‚Ä¢ Better for trading
                        </p>
                    </div>
                    <form id="claude-form">
                        <!-- Authentication Mode -->
                        <div class="form-group" style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <label for="claude-auth-mode" style="font-weight: 600;">üîë Authentication Mode</label>
                            <select id="claude-auth-mode" class="form-control" onchange="toggleClaudeAuthMode()">
                                <option value="api_key">API Key (Official) ‚úÖ Recommended</option>
                                <option value="bearer_token">Bearer Token (Web UI) ‚ö†Ô∏è Experimental</option>
                            </select>
                            <small style="color: var(--text-secondary); margin-top: 8px; display: block;">
                                API Key: Official, stable, costs apply<br>
                                Bearer Token: Free (uses web subscription), expires periodically
                            </small>
                        </div>

                        <!-- API Key Mode -->
                        <div id="claude-apikey-section">
                            <div class="form-group">
                                <label for="claude-api-key">API Key</label>
                                <div class="input-group">
                                    <input type="password" id="claude-api-key" class="form-control" 
                                           placeholder="sk-ant-...">
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="toggleVisibility('claude-api-key')">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <small>Get from <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a> ‚Ä¢ Cost: ~$0.00025/analysis</small>
                            </div>
                        </div>

                        <!-- Bearer Token Mode -->
                        <div id="claude-bearer-section" style="display: none;">
                            <div class="form-group">
                                <label for="claude-bearer-token">Bearer Token</label>
                                <div class="input-group">
                                    <input type="password" id="claude-bearer-token" class="form-control" 
                                           placeholder="eyJ... (from browser)">
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="toggleVisibility('claude-bearer-token')">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <small style="color: var(--text-warning);">
                                    ‚ö†Ô∏è Token expires in ~24 hours. 
                                    <a href="#" onclick="showTokenInstructions('claude'); return false;">How to get token?</a>
                                </small>
                            </div>
                            <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 12px; border-radius: 8px; margin-top: 10px;">
                                <strong>‚ö†Ô∏è Warning:</strong> Using bearer tokens may violate Terms of Service. Use at your own risk. For personal/testing only.
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="claude-model">Model</label>
                            <select id="claude-model" class="form-control">
                                <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku (Fastest, Cheapest) ‚≠ê</option>
                                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Balanced)</option>
                                <option value="claude-3-opus-20240229">Claude 3 Opus (Most Powerful)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="claude-enabled">
                                <span>Enable Claude for trade analysis</span>
                            </label>
                        </div>
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">üíæ Save Config</button>
                            <button type="button" class="btn btn-secondary" onclick="testAIConnection('claude')">
                                üß™ Test Connection
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Google Gemini Configuration -->
            <div class="card" style="margin-bottom: 20px; border: 3px solid #4285f4;">
                <div class="card-header" style="background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); color: white;">
                    <h3>‚ú® Google Gemini üéÅ FREE!</h3>
                    <span id="gemini-status" class="status-indicator" style="background: white;">‚óè</span>
                </div>
                <div class="card-body">
                    <div style="background: #e8f5e9; border: 2px solid #4caf50; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <strong style="color: #2e7d32; font-size: 18px;">üéâ 500 FREE Analyses Per Day!</strong>
                        <p style="margin: 10px 0 0 0; color: #1b5e20;">
                            ‚úÖ No credit card required<br>
                            ‚úÖ No payment needed<br>
                            ‚úÖ 15,000 free analyses per month<br>
                            ‚úÖ Latest AI model (Gemini 2.5 Flash)<br>
                            <strong>Get your free API key:</strong> <a href="https://aistudio.google.com" target="_blank" style="color: #1976d2; font-weight: 600;">aistudio.google.com</a>
                        </p>
                    </div>
                    <form id="gemini-form">
                        <div class="form-group">
                            <label for="gemini-api-key">API Key</label>
                            <div class="input-group">
                                <input type="password" id="gemini-api-key" class="form-control" 
                                       placeholder="AIza...">
                                <button type="button" class="btn btn-sm btn-secondary" onclick="toggleVisibility('gemini-api-key')">
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <small>
                                Free at <a href="https://aistudio.google.com" target="_blank">aistudio.google.com</a> ‚Ä¢ 
                                500 requests/day FREE ‚Ä¢ No credit card needed
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="gemini-model">Model</label>
                            <select id="gemini-model" class="form-control">
                                <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash (Experimental) ‚ö° Fastest</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash (Stable) ‚úÖ Recommended</option>
                                <option value="gemini-1.5-pro">Gemini 1.5 Pro (Advanced)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="gemini-enabled">
                                <span>Enable Gemini for trade analysis</span>
                            </label>
                        </div>
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">üíæ Save Config</button>
                            <button type="button" class="btn btn-secondary" onclick="testAIConnection('gemini')">
                                üß™ Test Connection
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- OpenAI Configuration -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <h3>üí¨ OpenAI (ChatGPT)</h3>
                    <span id="openai-status" class="status-indicator">‚óè</span>
                </div>
                <div class="card-body">
                    <form id="openai-form">
                        <!-- Authentication Mode -->
                        <div class="form-group" style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <label for="openai-auth-mode" style="font-weight: 600;">üîë Authentication Mode</label>
                            <select id="openai-auth-mode" class="form-control" onchange="toggleOpenAIAuthMode()">
                                <option value="api_key">API Key (Official) ‚úÖ Recommended</option>
                                <option value="bearer_token">Bearer Token (Web UI) ‚ùå Not Working</option>
                            </select>
                            <small style="color: var(--text-secondary); margin-top: 8px; display: block;">
                                <strong>Note:</strong> Web UI bearer tokens don't work with the official API.<br>
                                <strong style="color: var(--text-primary);">üí° Try Claude instead</strong> - Has free tier and works better!
                            </small>
                        </div>

                        <!-- API Key Mode -->
                        <div id="openai-apikey-section">
                            <div class="form-group">
                                <label for="openai-api-key">API Key</label>
                                <div class="input-group">
                                    <input type="password" id="openai-api-key" class="form-control" 
                                           placeholder="sk-...">
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="toggleVisibility('openai-api-key')">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <small>Get from <a href="https://platform.openai.com/" target="_blank">platform.openai.com</a> ‚Ä¢ Cost: ~$0.0005/analysis</small>
                            </div>
                        </div>

                        <!-- Bearer Token Mode -->
                        <div id="openai-bearer-section" style="display: none;">
                            <div class="form-group">
                                <label for="openai-bearer-token">Bearer Token</label>
                                <div class="input-group">
                                    <input type="password" id="openai-bearer-token" class="form-control" 
                                           placeholder="eyJ... (from browser)">
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="toggleVisibility('openai-bearer-token')">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <small style="color: var(--text-warning);">
                                    ‚ö†Ô∏è Token expires in ~24 hours. 
                                    <a href="#" onclick="showTokenInstructions('openai'); return false;">How to get token?</a>
                                </small>
                            </div>
                            <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 12px; border-radius: 8px; margin-top: 10px;">
                                <strong>‚ö†Ô∏è Warning:</strong> Using bearer tokens may violate Terms of Service. Use at your own risk. For personal/testing only.
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="openai-model">Model</label>
                            <select id="openai-model" class="form-control">
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast & Cheap)</option>
                                <option value="gpt-4-turbo-preview">GPT-4 Turbo (Better Quality)</option>
                                <option value="gpt-4">GPT-4 (Best Quality)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="openai-enabled">
                                <span>Enable OpenAI for trade analysis</span>
                            </label>
                        </div>
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">üíæ Save Config</button>
                            <button type="button" class="btn btn-secondary" onclick="testAIConnection('openai')">
                                üß™ Test Connection
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Trading Settings Section -->
        <div id="trading-settings-section" class="content-section">
            <div class="section-header">
                <h2>üìä Trading Settings</h2>
                <p class="subtitle">Configure your trading preferences and risk management</p>
            </div>
            
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <h3>üí∞ Capital & Risk</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="checkbox-label" style="margin-bottom: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="live-trading-enabled">
                            <span style="flex: 1;">
                                <strong style="display: block; margin-bottom: 5px;">üöÄ Enable Live Trading</strong>
                                <small class="text-secondary">Allow placing real orders on Zerodha (requires Zerodha connection)</small>
                            </span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="default-capital">Default Capital</label>
                        <input type="number" id="default-capital" class="form-control" 
                               value="100000" placeholder="100000">
                        <small>Total capital available for trading</small>
                    </div>
                    <div class="form-group">
                        <label for="risk-per-trade">Risk Per Trade (%)</label>
                        <input type="number" id="risk-per-trade" class="form-control" 
                               value="2" min="0.5" max="10" step="0.5" placeholder="2">
                        <small>Percentage of capital to risk per trade (Recommended: 1-2%)</small>
                    </div>
                    <div class="form-group">
                        <label for="max-positions">Max Concurrent Positions</label>
                        <input type="number" id="max-positions" class="form-control" 
                               value="10" min="1" max="50" placeholder="10">
                        <small>Maximum number of open positions at once</small>
                    </div>
                    <button class="btn btn-primary" onclick="saveTradingSettings()">üíæ Save Settings</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>‚öôÔ∏è Strategy Preferences</h3>
                </div>
                <div class="card-body">
                    <p><strong>Default Strategies:</strong></p>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="strategy-momentum" checked>
                            <span>Momentum BTST (1-3 days)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="strategy-swing" checked>
                            <span>Swing SuperTrend (7-30 days)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="strategy-mean-reversion" checked>
                            <span>Mean Reversion (2-5 days)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="strategy-pullback" checked>
                            <span>Pullback Entry (5-30 days)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="strategy-breakout" checked>
                            <span>Swing Breakout India (7 days)</span>
                        </label>
                    </div>
                    <button class="btn btn-primary" onclick="saveStrategyPreferences()">üíæ Save Preferences</button>
                </div>
            </div>
        </div>

        <!-- Notifications Section -->
        <div id="notifications-section" class="content-section">
            <div class="section-header">
                <h2>üîî Notifications</h2>
                <p class="subtitle">Configure alerts and notifications</p>
            </div>
            
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <h3>üìß Email Notifications</h3>
                </div>
                <div class="card-body">
                    <p class="text-secondary" style="margin-bottom: 20px;">
                        Get notified about important trading events via email
                    </p>
                    <div class="form-group">
                        <label for="notification-email">Email Address</label>
                        <input type="email" id="notification-email" class="form-control" 
                               placeholder="your@email.com" readonly style="background: var(--bg-tertiary);">
                        <small>Email is pre-filled from your account. To change, update your profile.</small>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify-trade-signals">
                            <span>New trade signals (when scanner finds opportunities)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify-trade-exit">
                            <span>Trade exits (when SL or Target is hit)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify-daily-summary">
                            <span>Daily summary report (end of day portfolio summary)</span>
                        </label>
                    </div>
                    <button class="btn btn-primary" onclick="saveNotificationSettings()">üíæ Save Notification Settings</button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px;">
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">
                            <strong>üìù Note:</strong> Email notifications are currently in development. 
                            When enabled, you'll receive emails for selected events.
                        </p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>üì± Push Notifications</h3>
                </div>
                <div class="card-body">
                    <p class="text-muted">Coming soon! Enable browser push notifications for real-time alerts.</p>
                    <button class="btn btn-secondary" disabled>üîî Enable Push Notifications</button>
                </div>
            </div>
        </div>

        <!-- Appearance Section -->
        <div id="appearance-section" class="content-section">
            <div class="section-header">
                <h2>üé® Appearance</h2>
                <p class="subtitle">Customize the look and feel of the application</p>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>üåó Theme</h3>
                </div>
                <div class="card-body">
                    <p class="text-secondary" style="margin-bottom: 20px;">
                        Choose between light and dark mode. Your preference will be saved and applied across all pages.
                    </p>
                    
                    <div class="theme-options">
                        <label class="theme-option">
                            <input type="radio" name="theme" id="theme-light" value="light" checked>
                            <div class="theme-preview light-preview">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-card"></div>
                                    <div class="preview-card"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <strong>‚òÄÔ∏è Light Mode</strong>
                                <p>Clean and bright interface</p>
                            </div>
                        </label>
                        
                        <label class="theme-option">
                            <input type="radio" name="theme" id="theme-dark" value="dark">
                            <div class="theme-preview dark-preview">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-card"></div>
                                    <div class="preview-card"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <strong>üåô Dark Mode</strong>
                                <p>Easy on the eyes</p>
                            </div>
                        </label>
                    </div>
                    
                    <button class="btn btn-primary" onclick="applySelectedTheme()" style="margin-top: 20px;">
                        üíæ Apply Theme
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>üî§ Display Preferences</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="font-size">Font Size</label>
                        <select id="font-size" class="form-control">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium (Default)</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="compact-mode">
                            <span>Compact mode (Reduce spacing)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="animations-enabled" checked>
                            <span>Enable animations</span>
                        </label>
                    </div>
                    <button class="btn btn-primary" onclick="saveDisplayPreferences()">
                        üíæ Save Preferences
                    </button>
                </div>
            </div>
        </div>

        <!-- Security Section -->
        <div id="security-section" class="content-section">
            <div class="section-header">
                <h2>üîí Security</h2>
                <p class="subtitle">Manage your account security</p>
            </div>
            
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <h3>üîë Change Password</h3>
                </div>
                <div class="card-body">
                    <form id="change-password-form">
                        <div class="form-group">
                            <label for="current-password">Current Password</label>
                            <input type="password" id="current-password" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="new-password">New Password</label>
                            <input type="password" id="new-password" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirm New Password</label>
                            <input type="password" id="confirm-password" class="form-control">
                        </div>
                        <button type="submit" class="btn btn-primary">üîí Update Password</button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>üìú Session Management</h3>
                </div>
                <div class="card-body">
                    <p>Active sessions: <strong>1</strong></p>
                    <p class="text-muted">Current device: Windows PC</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-danger" onclick="logout()">üö™ Logout</button>
                        <button class="btn btn-danger" onclick="logoutAllSessions()">üö™ Logout All Devices</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Tab Switching
function switchTab(event, tabName) {
    event.preventDefault();
    
    // Update nav items
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    event.currentTarget.classList.add('active');
    
    // Update content sections
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById(tabName + '-section').classList.add('active');
    
    // Update URL hash
    window.location.hash = tabName;
}

// Load correct tab from URL hash on page load
window.addEventListener('DOMContentLoaded', () => {
    const hash = window.location.hash.substring(1);
    if (hash) {
        const navItem = document.querySelector(`a[href="#${hash}"]`);
        if (navItem) {
            navItem.click();
        }
    }
    
    // Load user profile
    loadUserProfile();
    checkZerodhaStatus();
    loadAIConfig();
    loadTradingSettings();
    loadNotificationSettings();
    updateAIIndicators();
});

// User Profile
async function loadUserProfile() {
    try {
        // Try to fetch real user data from API
        const authToken = localStorage.getItem('auth_token');
        
        if (authToken) {
            const response = await fetch('/api/auth/profile', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                
                // Display real user data
                document.getElementById('user-profile').innerHTML = `
                    <div class="user-info-grid">
                        <div class="user-info-item">
                            <span class="label">Username:</span>
                            <span class="value">${data.username}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Email:</span>
                            <span class="value">${data.email}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Full Name:</span>
                            <span class="value">${data.full_name || 'Not set'}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Member Since:</span>
                            <span class="value">${new Date(data.created_at).toLocaleDateString()}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Total Trades:</span>
                            <span class="value">${data.total_trades}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Active Trades:</span>
                            <span class="value">${data.active_trades}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Completed Trades:</span>
                            <span class="value">${data.completed_trades}</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">Account Status:</span>
                            <span class="value" style="color: #10b981;">‚úì Active</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" style="margin-top: 20px;" onclick="editProfile()">
                        ‚úèÔ∏è Edit Profile
                    </button>
                `;
                return;
            }
        }
        
        // Fallback: Show message if not logged in
        document.getElementById('user-profile').innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Please log in to view your profile
                </p>
                <a href="/login" class="btn btn-primary">
                    üîê Login
                </a>
            </div>
        `;
        
    } catch (error) {
        console.error('Error loading user profile:', error);
        document.getElementById('user-profile').innerHTML = `
            <div style="text-align: center; padding: 20px;">
                <p style="color: var(--danger);">
                    Error loading profile data. Please try refreshing the page.
                </p>
            </div>
        `;
    }
}

function editProfile() {
    alert('Profile editing coming soon!');
}

// Zerodha Connection
function checkZerodhaStatus() {
    const connected = localStorage.getItem('zerodha_connected') === 'true';
    
    if (connected) {
        document.getElementById('zerodha-disconnected').style.display = 'none';
        document.getElementById('zerodha-connected').style.display = 'block';
        document.getElementById('zerodha-indicator').className = 'nav-badge badge-success';
        document.getElementById('zerodha-indicator').textContent = '‚óè';
        document.getElementById('zerodha-user-info').textContent = 'Connected as: Demo User';
    } else {
        document.getElementById('zerodha-disconnected').style.display = 'block';
        document.getElementById('zerodha-connected').style.display = 'none';
        document.getElementById('zerodha-indicator').className = 'nav-badge badge-warning';
        document.getElementById('zerodha-indicator').textContent = '‚óè';
    }
}

document.getElementById('connect-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    localStorage.setItem('zerodha_connected', 'true');
    checkZerodhaStatus();
    showToast('Zerodha connected successfully!', 'success');
});

document.getElementById('disconnect-btn')?.addEventListener('click', () => {
    if (confirm('Disconnect from Zerodha?')) {
        localStorage.removeItem('zerodha_connected');
        checkZerodhaStatus();
        showToast('Zerodha disconnected', 'info');
    }
});

function refreshZerodhaStatus() {
    checkZerodhaStatus();
    showToast('Status refreshed', 'info');
}

// AI Configuration (keep existing functions)
function loadAIConfig() {
    const config = JSON.parse(localStorage.getItem('ai_config') || '{}');
    
    // Load Gemini config
    if (config.gemini) {
        document.getElementById('gemini-api-key').value = config.gemini.api_key || '';
        document.getElementById('gemini-model').value = config.gemini.model || 'gemini-1.5-flash';
        document.getElementById('gemini-enabled').checked = config.gemini.enabled || false;
    }
    
    // Load Claude config
    if (config.claude) {
        const claudeAuthMode = config.claude.auth_mode || 'api_key';
        document.getElementById('claude-auth-mode').value = claudeAuthMode;
        document.getElementById('claude-api-key').value = config.claude.api_key || '';
        document.getElementById('claude-bearer-token').value = config.claude.bearer_token || '';
        document.getElementById('claude-model').value = config.claude.model || 'claude-3-5-haiku-20241022';
        document.getElementById('claude-enabled').checked = config.claude.enabled || false;
        toggleClaudeAuthMode(); // Show/hide appropriate sections
    }
    
    // Load OpenAI config
    if (config.openai) {
        const openaiAuthMode = config.openai.auth_mode || 'api_key';
        if (document.getElementById('openai-auth-mode')) {
            document.getElementById('openai-auth-mode').value = openaiAuthMode;
        }
        document.getElementById('openai-api-key').value = config.openai.api_key || '';
        if (document.getElementById('openai-bearer-token')) {
            document.getElementById('openai-bearer-token').value = config.openai.bearer_token || '';
        }
        document.getElementById('openai-model').value = config.openai.model || 'gpt-3.5-turbo';
        document.getElementById('openai-enabled').checked = config.openai.enabled || false;
        toggleOpenAIAuthMode(); // Show/hide appropriate sections
    }
    
    // Load general settings
    document.getElementById('default-ai-provider').value = config.default_provider || 'gemini';
    
    updateAIStatusIndicators();
}

function saveAIConfig(provider) {
    const config = JSON.parse(localStorage.getItem('ai_config') || '{}');
    
    if (provider === 'claude') {
        const authMode = document.getElementById('claude-auth-mode').value;
        
        config.claude = {
            auth_mode: authMode,
            api_key: authMode === 'api_key' ? document.getElementById('claude-api-key').value : '',
            bearer_token: authMode === 'bearer_token' ? document.getElementById('claude-bearer-token').value : '',
            model: document.getElementById('claude-model').value,
            enabled: document.getElementById('claude-enabled').checked
        };
        
        // Auto-set as default if enabled with valid credentials
        const hasCredentials = (authMode === 'api_key' && config.claude.api_key.trim()) || 
                               (authMode === 'bearer_token' && config.claude.bearer_token.trim());
        if (config.claude.enabled && hasCredentials) {
            config.default_provider = 'claude';
            document.getElementById('default-ai-provider').value = 'claude';
            console.log('‚úÖ Auto-set Claude as default provider');
        }
        
        showToast('Claude configuration saved!', 'success');
    } else if (provider === 'openai') {
        const authMode = document.getElementById('openai-auth-mode')?.value || 'api_key';
        
        config.openai = {
            auth_mode: authMode,
            api_key: authMode === 'api_key' ? document.getElementById('openai-api-key').value : '',
            bearer_token: authMode === 'bearer_token' ? document.getElementById('openai-bearer-token')?.value || '' : '',
            model: document.getElementById('openai-model').value,
            enabled: document.getElementById('openai-enabled').checked
        };
        
        // Auto-set as default if enabled with valid credentials
        const hasCredentials = (authMode === 'api_key' && config.openai.api_key.trim()) || 
                               (authMode === 'bearer_token' && config.openai.bearer_token?.trim());
        if (config.openai.enabled && hasCredentials) {
            config.default_provider = 'openai';
            document.getElementById('default-ai-provider').value = 'openai';
            console.log('‚úÖ Auto-set OpenAI as default provider');
        }
        
        showToast('OpenAI configuration saved!', 'success');
    } else if (provider === 'gemini') {
        config.gemini = {
            api_key: document.getElementById('gemini-api-key').value,
            model: document.getElementById('gemini-model').value,
            enabled: document.getElementById('gemini-enabled').checked
        };
        
        // Auto-set as default if enabled with valid API key
        if (config.gemini.enabled && config.gemini.api_key && config.gemini.api_key.trim() !== '') {
            config.default_provider = 'gemini';
            document.getElementById('default-ai-provider').value = 'gemini';
            console.log('‚úÖ Auto-set Gemini as default provider');
        }
        
        showToast('Gemini configuration saved! üéâ', 'success');
    } else if (provider === 'general') {
        showToast('Default AI provider updated!', 'success');
    }
    
    // Always save default provider from dropdown
    const defaultProviderSelect = document.getElementById('default-ai-provider');
    if (defaultProviderSelect) {
        config.default_provider = defaultProviderSelect.value;
    }
    
    // Fallback: If no default provider, use first available
    if (!config.default_provider) {
        if (config.gemini?.enabled && config.gemini?.api_key) {
            config.default_provider = 'gemini';
        } else if (config.claude?.enabled && config.claude?.api_key) {
            config.default_provider = 'claude';
        } else if (config.openai?.enabled && config.openai?.api_key) {
            config.default_provider = 'openai';
        }
    }
    
    localStorage.setItem('ai_config', JSON.stringify(config));
    updateAIStatusIndicators();
    updateAIIndicators();
    
    console.log('‚úÖ AI Config Saved:', {
        default_provider: config.default_provider,
        gemini_enabled: config.gemini?.enabled,
        claude_enabled: config.claude?.enabled,
        openai_enabled: config.openai?.enabled
    });
}

document.getElementById('gemini-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    saveAIConfig('gemini');
});

document.getElementById('claude-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    saveAIConfig('claude');
});

document.getElementById('openai-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    saveAIConfig('openai');
});

document.getElementById('default-ai-provider')?.addEventListener('change', () => {
    saveAIConfig('general');
});

function updateAIStatusIndicators() {
    const config = JSON.parse(localStorage.getItem('ai_config') || '{}');
    
    // Claude status
    const claudeStatus = document.getElementById('claude-status');
    if (config.claude?.enabled && config.claude?.api_key) {
        claudeStatus.style.color = '#4caf50';
        claudeStatus.title = 'Connected';
    } else {
        claudeStatus.style.color = '#9e9e9e';
        claudeStatus.title = 'Disconnected';
    }
    
    // OpenAI status
    const openaiStatus = document.getElementById('openai-status');
    if (config.openai?.enabled && config.openai?.api_key) {
        openaiStatus.style.color = '#4caf50';
        openaiStatus.title = 'Connected';
    } else {
        openaiStatus.style.color = '#9e9e9e';
        openaiStatus.title = 'Disconnected';
    }
}

function updateAIIndicators() {
    const config = JSON.parse(localStorage.getItem('ai_config') || '{}');
    const indicator = document.getElementById('ai-indicator');
    
    const hasAI = (config.claude?.enabled && config.claude?.api_key) || 
                  (config.openai?.enabled && config.openai?.api_key);
    
    if (hasAI) {
        indicator.className = 'nav-badge badge-success';
        indicator.textContent = '‚úì';
    } else {
        indicator.className = 'nav-badge badge-secondary';
        indicator.textContent = '!';
    }
}

function toggleVisibility(fieldId) {
    const field = document.getElementById(fieldId);
    field.type = field.type === 'password' ? 'text' : 'password';
}

function testAIConnection(provider) {
    showToast(`Testing ${provider} connection...`, 'info');
    // Placeholder - would call actual API
    setTimeout(() => {
        showToast(`${provider} connection test successful!`, 'success');
    }, 1500);
}

// Trading Settings
function loadTradingSettings() {
    const settings = JSON.parse(localStorage.getItem('trading_settings') || '{}');
    
    document.getElementById('live-trading-enabled').checked = settings.live_trading_enabled || false;
    document.getElementById('default-capital').value = settings.capital || 100000;
    document.getElementById('risk-per-trade').value = settings.risk_per_trade || 2;
    document.getElementById('max-positions').value = settings.max_positions || 10;
}

function saveTradingSettings() {
    const settings = {
        live_trading_enabled: document.getElementById('live-trading-enabled').checked,
        capital: parseFloat(document.getElementById('default-capital').value),
        risk_per_trade: parseFloat(document.getElementById('risk-per-trade').value),
        max_positions: parseInt(document.getElementById('max-positions').value)
    };
    
    localStorage.setItem('trading_settings', JSON.stringify(settings));
    showToast('Trading settings saved!', 'success');
    
    // Also update the global flag for other pages
    localStorage.setItem('live_trading_enabled', settings.live_trading_enabled);
}

function saveStrategyPreferences() {
    const preferences = {
        momentum: document.getElementById('strategy-momentum').checked,
        swing: document.getElementById('strategy-swing').checked,
        mean_reversion: document.getElementById('strategy-mean-reversion').checked,
        pullback: document.getElementById('strategy-pullback').checked,
        breakout: document.getElementById('strategy-breakout').checked
    };
    
    localStorage.setItem('strategy_preferences', JSON.stringify(preferences));
    showToast('Strategy preferences saved!', 'success');
}

// Security
document.getElementById('change-password-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const newPass = document.getElementById('new-password').value;
    const confirmPass = document.getElementById('confirm-password').value;
    
    if (newPass !== confirmPass) {
        showToast('Passwords do not match!', 'error');
        return;
    }
    
    showToast('Password updated successfully!', 'success');
    e.target.reset();
});

function logout() {
    if (confirm('Are you sure you want to logout?')) {
        // Clear ALL localStorage data
        localStorage.clear();
        
        // Also clear sessionStorage
        sessionStorage.clear();
        
        // Show message and redirect
        alert('‚úÖ Logged out successfully. All local data cleared.');
        window.location.href = '/login';
    }
}

function logoutAllSessions() {
    if (confirm('Are you sure you want to logout from all devices? This will clear all saved data.')) {
        // Clear ALL localStorage data
        localStorage.clear();
        
        // Also clear sessionStorage
        sessionStorage.clear();
        
        // Show message and redirect
        alert('‚úÖ Logged out from all devices. All local data cleared.');
        window.location.href = '/login';
    }
}

// Toast notifications
function showToast(message, type = 'info') {
    // Use existing toast system
    console.log(`[${type.toUpperCase()}] ${message}`);
    // TODO: Implement actual toast notification
}

// Notification Settings
async function loadNotificationSettings() {
    try {
        // Get user email from API
        const authToken = localStorage.getItem('auth_token');
        if (authToken) {
            const response = await fetch('/api/auth/profile', {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });
            
            if (response.ok) {
                const data = await response.json();
                // Pre-fill email from user profile
                document.getElementById('notification-email').value = data.email;
            }
        }
        
        // Load notification preferences from localStorage
        const settings = JSON.parse(localStorage.getItem('notification_settings') || '{}');
        document.getElementById('notify-trade-signals').checked = settings.trade_signals || false;
        document.getElementById('notify-trade-exit').checked = settings.trade_exit || false;
        document.getElementById('notify-daily-summary').checked = settings.daily_summary || false;
    } catch (error) {
        console.error('Error loading notification settings:', error);
    }
}

function saveNotificationSettings() {
    const settings = {
        email: document.getElementById('notification-email').value,
        trade_signals: document.getElementById('notify-trade-signals').checked,
        trade_exit: document.getElementById('notify-trade-exit').checked,
        daily_summary: document.getElementById('notify-daily-summary').checked
    };
    
    localStorage.setItem('notification_settings', JSON.stringify(settings));
    
    // Show informative message
    if (settings.trade_signals || settings.trade_exit || settings.daily_summary) {
        showToast('Notification preferences saved! Email notifications will be sent when ready.', 'success');
    } else {
        showToast('All notifications disabled', 'info');
    }
}

// Appearance Settings
function applySelectedTheme() {
    const lightRadio = document.getElementById('theme-light');
    const darkRadio = document.getElementById('theme-dark');
    
    const selectedTheme = lightRadio.checked ? 'light' : 'dark';
    applyTheme(selectedTheme);
    showToast(`Theme changed to ${selectedTheme} mode`, 'success');
}

function saveDisplayPreferences() {
    const preferences = {
        fontSize: document.getElementById('font-size').value,
        compactMode: document.getElementById('compact-mode').checked,
        animationsEnabled: document.getElementById('animations-enabled').checked
    };
    
    localStorage.setItem('display_preferences', JSON.stringify(preferences));
    showToast('Display preferences saved!', 'success');
    
    // Apply preferences
    applyDisplayPreferences(preferences);
}

function applyDisplayPreferences(preferences) {
    // Apply font size
    document.documentElement.style.setProperty('--base-font-size', 
        preferences.fontSize === 'small' ? '14px' : 
        preferences.fontSize === 'large' ? '18px' : '16px');
    
    // Apply compact mode
    if (preferences.compactMode) {
        document.documentElement.classList.add('compact-mode');
    } else {
        document.documentElement.classList.remove('compact-mode');
    }
    
    // Apply animations
    if (!preferences.animationsEnabled) {
        document.documentElement.style.setProperty('--transition-speed', '0s');
    } else {
        document.documentElement.style.setProperty('--transition-speed', '0.3s');
    }
}

// Load display preferences on page load
function loadDisplayPreferences() {
    const preferences = JSON.parse(localStorage.getItem('display_preferences') || '{}');
    
    if (preferences.fontSize) {
        document.getElementById('font-size').value = preferences.fontSize;
    }
    if (preferences.compactMode !== undefined) {
        document.getElementById('compact-mode').checked = preferences.compactMode;
    }
    if (preferences.animationsEnabled !== undefined) {
        document.getElementById('animations-enabled').checked = preferences.animationsEnabled;
    }
    
    // Apply preferences
    if (Object.keys(preferences).length > 0) {
        applyDisplayPreferences(preferences);
    }
}

// Call loadDisplayPreferences in DOMContentLoaded
window.addEventListener('DOMContentLoaded', () => {
    loadDisplayPreferences();
    
    // Check authentication
    const authToken = localStorage.getItem('auth_token');
    if (!authToken) {
        window.location.href = '/login';
        return;
    }
});

// Toggle Claude Auth Mode (API Key vs Bearer Token)
function toggleClaudeAuthMode() {
    const mode = document.getElementById('claude-auth-mode').value;
    const apiKeySection = document.getElementById('claude-apikey-section');
    const bearerSection = document.getElementById('claude-bearer-section');
    
    if (mode === 'bearer_token') {
        apiKeySection.style.display = 'none';
        bearerSection.style.display = 'block';
    } else {
        apiKeySection.style.display = 'block';
        bearerSection.style.display = 'none';
    }
}

// Toggle OpenAI Auth Mode
function toggleOpenAIAuthMode() {
    const mode = document.getElementById('openai-auth-mode').value;
    const apiKeySection = document.getElementById('openai-apikey-section');
    const bearerSection = document.getElementById('openai-bearer-section');
    
    if (mode === 'bearer_token') {
        apiKeySection.style.display = 'none';
        bearerSection.style.display = 'block';
    } else {
        apiKeySection.style.display = 'block';
        bearerSection.style.display = 'none';
    }
}

// Show Token Extraction Instructions
function showTokenInstructions(provider) {
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;';
    
    const instructions = provider === 'claude' ? `
        <div style="background: var(--card-bg); border-radius: 12px; max-width: 700px; max-height: 90vh; overflow-y: auto; padding: 30px;">
            <h2 style="margin-top: 0; color: var(--text-primary);">üîë How to Get Claude Bearer Token</h2>
            
            <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>‚ö†Ô∏è Important:</strong> This method may violate Claude's Terms of Service. Use for personal testing only. Token expires in ~24 hours.
            </div>
            
            <ol style="line-height: 2; color: var(--text-primary);">
                <li>Open <a href="https://claude.ai" target="_blank">claude.ai</a> and login</li>
                <li>Open Browser DevTools (Press <code>F12</code>)</li>
                <li>Go to <strong>Network</strong> tab</li>
                <li>Send a message to Claude</li>
                <li>Look for a request to <code>api/organizations/...</code></li>
                <li>Click on it, then go to <strong>Headers</strong> section</li>
                <li>Find <code>Authorization: Bearer eyJ...</code></li>
                <li>Copy everything after "Bearer " (starts with eyJ)</li>
                <li>Paste it in the Bearer Token field above</li>
            </ol>
            
            <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-top: 20px;">
                <strong>üí° Tips:</strong>
                <ul style="margin: 10px 0;">
                    <li>Token is long (500+ characters)</li>
                    <li>Starts with "eyJ"</li>
                    <li>Expires after ~24 hours</li>
                    <li>Refresh when you see errors</li>
                </ul>
            </div>
            
            <button onclick="this.closest('div').parentElement.remove()" style="background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%;">
                Got it!
            </button>
        </div>
    ` : `
        <div style="background: var(--card-bg); border-radius: 12px; max-width: 700px; max-height: 90vh; overflow-y: auto; padding: 30px;">
            <h2 style="margin-top: 0; color: var(--text-primary);">üîë How to Get OpenAI Bearer Token</h2>
            
            <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>‚ö†Ô∏è Important:</strong> This method may violate OpenAI's Terms of Service. Use for personal testing only. Token expires in ~24 hours.
            </div>
            
            <ol style="line-height: 2; color: var(--text-primary);">
                <li>Open <a href="https://chat.openai.com" target="_blank">chat.openai.com</a> and login</li>
                <li>Open Browser DevTools (Press <code>F12</code>)</li>
                <li>Go to <strong>Network</strong> tab</li>
                <li>Send a message to ChatGPT</li>
                <li>Look for a request to <code>backend-api/conversation</code></li>
                <li>Click on it, then go to <strong>Headers</strong> section</li>
                <li>Find <code>Authorization: Bearer eyJ...</code></li>
                <li>Copy everything after "Bearer " (starts with eyJ)</li>
                <li>Paste it in the Bearer Token field above</li>
            </ol>
            
            <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-top: 20px;">
                <strong>üí° Tips:</strong>
                <ul style="margin: 10px 0;">
                    <li>Token is long (500+ characters)</li>
                    <li>Starts with "eyJ"</li>
                    <li>Expires after ~24 hours</li>
                    <li>Refresh when you see errors</li>
                </ul>
            </div>
            
            <button onclick="this.closest('div').parentElement.remove()" style="background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%;">
                Got it!
            </button>
        </div>
    `;
    
    modal.innerHTML = instructions;
    modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
    };
    document.body.appendChild(modal);
}
</script>

<style>
.profile-container {
    display: flex;
    min-height: calc(100vh - 100px);
    margin-top: 20px;
    gap: 0;
}

.profile-sidebar {
    width: 250px;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px 0 0 12px;
    padding: 0;
    position: sticky;
    top: 80px;
    height: fit-content;
    max-height: calc(100vh - 100px);
    overflow-y: auto;
}

.sidebar-header {
    padding: 25px 20px;
    border-bottom: 1px solid var(--border-color);
}

.sidebar-header h3 {
    margin: 0;
    font-size: 20px;
    color: var(--text-primary);
}

.sidebar-nav {
    padding: 10px 0;
}

.nav-item {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
    position: relative;
}

.nav-item:hover {
    background: var(--hover-bg);
    color: var(--text-primary);
}

.nav-item.active {
    background: rgba(59, 130, 246, 0.1);
    border-left-color: var(--primary);
    color: var(--text-primary);
}

.nav-icon {
    font-size: 20px;
    margin-right: 12px;
    width: 24px;
    text-align: center;
}

.nav-text {
    flex: 1;
    font-size: 14px;
    font-weight: 500;
}

.nav-badge {
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    margin-left: auto;
}

.profile-content {
    flex: 1;
    padding: 30px 40px;
    background: var(--bg-secondary);
    border-radius: 0 12px 12px 0;
}

.content-section {
    display: none;
}

.content-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.section-header {
    margin-bottom: 30px;
}

.section-header h2 {
    margin: 0;
    font-size: 28px;
    color: var(--text-primary);
}

.section-header .subtitle {
    margin: 8px 0 0 0;
    color: var(--text-secondary);
    font-size: 14px;
}

.card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    margin-bottom: 20px;
}

.card-header {
    padding: 20px 25px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h3 {
    margin: 0;
    font-size: 18px;
    color: var(--text-primary);
}

.card-body {
    padding: 25px;
}

.text-secondary {
    color: var(--text-secondary);
}

.text-muted {
    color: var(--text-tertiary);
}

.status-indicator {
    font-size: 20px;
    transition: color 0.3s ease;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    background: var(--input-bg);
    border: 1px solid var(--input-border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 14px;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--input-bg);
}

.input-group {
    display: flex;
    gap: 10px;
}

.input-group .form-control {
    flex: 1;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    color: var(--text-primary);
}

.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.button-group {
    display: flex;
    gap: 10px;
}

.info-box {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.info-box ul {
    margin: 10px 0 0 20px;
    padding: 0;
}

.info-box li {
    margin: 8px 0;
    color: var(--text-secondary);
}

.success-box {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 8px;
    padding: 20px;
}

.success-box p {
    margin: 0;
    color: #10b981;
}

.connection-actions {
    display: flex;
    gap: 10px;
}

.user-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.user-info-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 15px;
    background: var(--bg-tertiary);
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

.user-info-item .label {
    color: var(--text-secondary);
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.user-info-item .value {
    color: var(--text-primary);
    font-size: 16px;
    font-weight: 600;
}

/* Theme Options */
.theme-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.theme-option {
    cursor: pointer;
    position: relative;
}

.theme-option input[type="radio"] {
    position: absolute;
    opacity: 0;
}

.theme-preview {
    width: 100%;
    height: 150px;
    border-radius: 8px;
    border: 2px solid transparent;
    overflow: hidden;
    transition: all 0.3s ease;
    margin-bottom: 10px;
}

.theme-option input[type="radio"]:checked + .theme-preview {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.light-preview {
    background: #ffffff;
}

.light-preview .preview-header {
    height: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.light-preview .preview-content {
    padding: 10px;
    background: #f9fafb;
    height: calc(100% - 30px);
}

.light-preview .preview-card {
    background: #ffffff;
    height: 40px;
    border-radius: 4px;
    margin-bottom: 8px;
    border: 1px solid #e5e7eb;
}

.dark-preview {
    background: #0f1419;
}

.dark-preview .preview-header {
    height: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.dark-preview .preview-content {
    padding: 10px;
    background: #0f1419;
    height: calc(100% - 30px);
}

.dark-preview .preview-card {
    background: #1a1f2e;
    height: 40px;
    border-radius: 4px;
    margin-bottom: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.theme-info {
    text-align: center;
}

.theme-info strong {
    display: block;
    margin-bottom: 5px;
    color: var(--text-primary);
}

.theme-info p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 13px;
}

/* Responsive */
@media (max-width: 968px) {
    .profile-container {
        flex-direction: column;
    }
    
    .profile-sidebar {
        width: 100%;
        border-radius: 12px 12px 0 0;
        position: static;
        max-height: none;
    }
    
    .sidebar-nav {
        display: flex;
        overflow-x: auto;
        padding: 0;
    }
    
    .nav-item {
        flex-direction: column;
        min-width: 100px;
        text-align: center;
        padding: 15px 10px;
        border-left: none;
        border-bottom: 3px solid transparent;
    }
    
    .nav-item.active {
        border-left: none;
        border-bottom-color: var(--primary);
    }
    
    .nav-icon {
        margin-right: 0;
        margin-bottom: 5px;
    }
    
    .nav-text {
        font-size: 12px;
    }
    
    .nav-badge {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    
    .profile-content {
        border-radius: 0 0 12px 12px;
        padding: 20px;
    }
}
</style>
{% endblock %}
